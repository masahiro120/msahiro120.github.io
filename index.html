<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>タイトル</title>
  <script src="https://cdn.jsdelivr.net/pyodide/v0.27.2/full/pyodide.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    #output {
      background-color: #f0f0f0;
      padding: 10px;
      border: 1px solid #ccc;
      white-space: pre-wrap; /* Preserve whitespace and line breaks */
      font-size: 18px; /* フォントサイズを大きく */
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <h1>二次関数 最大最小値計算</h1>

  <!-- ラジオボタン -->
  <div>
    <input type="radio" id="abc" name="formula" value="abc" style="font-size: 24px;" checked>
    <label for="abc" style="font-size: 24px;">y = ax² + bx + c</label>
    <input type="radio" id="apq" name="formula" value="apq" style="font-size: 24px;">
    <label for="apq" style="font-size: 24px;">y = a(x - p)² + q</label>
  </div>
  
  <!-- ax² + bx + c 用フォーム -->
  <div id="abc-form">
    <label style="font-size: 24px;">y = ax² + bx + c の範囲を計算します。</label><br>
    <label for="varA" style="font-size: 24px;">a:</label>
    <input type="text" id="varA" value="1" style="font-size: 40px; width: 100px;">
    <label for="varB" style="font-size: 24px;">b:</label>
    <input type="text" id="varB" value="2" style="font-size: 40px; width: 100px;">
    <label for="varC" style="font-size: 24px;">c:</label>
    <input type="text" id="varC" value="0" style="font-size: 40px; width: 100px;">
  </div>

  <!-- a(x-p)² + q 用フォーム -->
  <div id="apq-form" class="hidden">
    <label style="font-size: 24px;">y = a(x - p)² + q の範囲を計算します。</label><br>
    <label for="varA2" style="font-size: 24px;">a:</label>
    <input type="text" id="varA2" value="1" style="font-size: 40px; width: 100px;">
    <label for="varP" style="font-size: 24px;">p:</label>
    <input type="text" id="varP" value="1" style="font-size: 40px; width: 100px;">
    <label for="varQ" style="font-size: 24px;">q:</label>
    <input type="text" id="varQ" value="0" style="font-size: 40px; width: 100px;">
  </div>

  <br>

  <div>
    <label style="font-size: 24px;">範囲:</label>
    <input type="text" id="varD" value="-3" style="font-size: 40px; width: 100px;">
    〜
    <input type="text" id="varE" value="2" style="font-size: 40px; width: 100px;">
  </div>
  <br>

  <div id="abc-info" style="font-size: 20px;">
    ※ aは0以外の値を入力してください。<br>
    ※ b、cが0のときは省略可能です。<br>
    ※ 範囲の最小値は最大値より小さくしてください。
  </div>

  <div id="apq-info" class="hidden" style="font-size: 20px;">
    ※ aは0以外の値を入力してください。<br>
    ※ p、qが0のときは省略可能です。<br>
    ※ 範囲の最小値は最大値より小さくしてください。
  </div>

  <button id="run" onclick="main()" disabled style="font-size: 24px; padding: 10px 20px;">実行</button>
  
  <pre id="output"></pre>
  <script type="text/javascript">
    let pyodide;

    // ラジオボタン切り替えで表示変更
    document.querySelectorAll('input[name="formula"]').forEach(radio => {
      radio.addEventListener('change', () => {
        const abcForm = document.getElementById("abc-form");
        const apqForm = document.getElementById("apq-form");
        const abcInfo = document.getElementById("abc-info");
        const apqInfo = document.getElementById("apq-info");
        if (document.getElementById("abc").checked) {
          abcForm.classList.remove("hidden");
          apqForm.classList.add("hidden");
          abcInfo.classList.remove("hidden");
          apqInfo.classList.add("hidden");
        } else {
          abcForm.classList.add("hidden");
          apqForm.classList.remove("hidden");
          abcInfo.classList.add("hidden");
          apqInfo.classList.remove("hidden");
        }
      });
    });

    async function loadPyodideAndPackages() {
      pyodide = await loadPyodide();
      await pyodide.loadPackage(["matplotlib", "numpy"]);
      document.getElementById("run").disabled = false;
    }

    async function main() {
      document.getElementById("output").innerText = "";
      while (!pyodide) {
        await new Promise(resolve => setTimeout(resolve, 100));
      }
      
      let result = "";

      if (!document.getElementById("varA").value ||
          !document.getElementById("varD").value ||
          !document.getElementById("varE").value) {
        document.getElementById("output").innerText = "Error: すべてに値を入力してください";
        return;
      }

      if (isNaN(document.getElementById("varA").value) ||
          isNaN(document.getElementById("varD").value) ||
          isNaN(document.getElementById("varE").value)) {
        document.getElementById("output").innerText = "Error: すべてに数値を入力してください";
        return;
      }

      if (document.getElementById("varA").value == 0) {
        document.getElementById("output").innerText = "Error: aは0以外の値を入力してください";
        return;
      }

      if (parseFloat(document.getElementById("varD").value) >= parseFloat(document.getElementById("varE").value)) {
        document.getElementById("output").innerText = "Error: 範囲の最小値は最大値より小さくしてください";
        return;
      }

      let a = parseFloat(document.getElementById("varA").value);
      let b = parseFloat(document.getElementById("varB").value || 0);
      let c = parseFloat(document.getElementById("varC").value || 0);
      let d = parseFloat(document.getElementById("varD").value);
      let e = parseFloat(document.getElementById("varE").value);

      try {
        const res = await fetch("py_program.py");
        let code;
        if (res.ok) {
          code = "a = " + a + "\n" +
                 "b = " + b + "\n" +
                 "c = " + c + "\n" +
                 "d = " + d + "\n" +
                 "e = " + e + "\n" +
                 await res.text();
        } else {
          code = "print('Error: ファイルを読み込めません')";
        }

        pyodide.setStdout({ batched: (msg) => { result += msg + "\n"; } });
        await pyodide.runPythonAsync(code);

      } catch (error) {
        result = "エラー: " + error;
      }

      document.getElementById("output").innerText += result;
    }

    loadPyodideAndPackages();
  </script>
</body>
</html>
